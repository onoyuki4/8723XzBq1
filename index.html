<!-- index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Gallery</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 1rem; }
    h1 { text-align: center; cursor: pointer; /* 제목 클릭 시 전체 보기 */ }
    .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; max-width: 1000px; margin: auto; }
    .work { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .work a { text-decoration: none; color: inherit; display: block; }
    .work:hover { transform: scale(1.02); }

    /* --- 정보 영역 (이미지 위) --- */
    .work .info-top {
      padding: 0.75rem;
      text-align: left; /* 왼쪽 정렬 */
    }
    .work .title {
      font-weight: bold;
      font-size: 0.95em; /* 제목 크기 */
      display: block; /* 블록 요소로 만들어 줄바꿈 */
      margin-bottom: 0.25rem; /* 제목과 작가 사이 간격 */
      /* 긴 제목 처리 */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .work .author {
      font-size: 0.85em; /* 작가 이름 크기 */
      color: #555;
      cursor: pointer; /* 클릭 가능 표시 */
      display: inline-block; /* 클릭 영역 최소화 */
    }
     .work .author:hover {
      text-decoration: underline; /* 호버 시 밑줄 */
      color: #007bff;
    }

    /* --- 썸네일 이미지 --- */
    .work img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      display: block;
      border-top: 1px solid #eee; /* 정보 영역과 구분선 */
    }
    /* 필터링 시 안내 메시지 */
    .filter-info { text-align: center; margin: 1rem 0; font-weight: bold; }
    .filter-info button { margin-left: 0.5rem; }

  </style>
</head>
<body>
  <h1 id="main-title">Local Hitomi</h1>
  <!-- 필터링 정보 표시 영역 -->
  <div id="filter-info-container"></div>
  <div class="gallery" id="gallery-container"></div>

  <!-- *** 생성된 작품 목록 파일을 먼저 로드 *** -->
  <script src="works-list.js"></script>

  <script>
    // ========================================
    // === 작품 목록 정의 (이제 works-list.js에서 로드됨) ===
    // ========================================
    // const worksData = [...] // <<<--- 삭제됨!

    // ========================================
    // === DOM 요소 선택 ===
    // ========================================
    const galleryContainer = document.getElementById('gallery-container');
    const mainTitle = document.getElementById('main-title');
    const filterInfoContainer = document.getElementById('filter-info-container');
    let currentFilter = null; // 현재 필터링 중인 작가 이름 저장

    // ========================================
    // === 갤러리 렌더링 함수 ===
    // ========================================
    function renderGallery(dataToRender) {
      galleryContainer.innerHTML = ''; // 기존 갤러리 내용 비우기

      // 필터링 정보 업데이트
      updateFilterInfo();

      // worksData가 로드되지 않았거나 비어있는 경우 처리
      if (typeof dataToRender === 'undefined' || !Array.isArray(dataToRender) || dataToRender.length === 0) {
           const message = (typeof worksData === 'undefined') ? '작품 데이터를 불러올 수 없습니다. 빌드 스크립트를 실행하세요.' : '표시할 작품이 없습니다.';
           galleryContainer.innerHTML = `<p style="text-align: center;">${message}</p>`;
           return;
      }


      dataToRender.forEach(work => {
        try { // 개별 항목 렌더링 오류 방지
            const workDiv = document.createElement('div');
            workDiv.className = 'work';

            const link = document.createElement('a');
            link.href = `works/${work.id}/index.html`;

            // --- 정보 영역 (이미지 위) ---
            const infoDiv = document.createElement('div');
            infoDiv.className = 'info-top';

            const titleSpan = document.createElement('span');
            titleSpan.className = 'title';
            titleSpan.textContent = work.title;
            titleSpan.title = work.title; // 긴 제목 툴팁

            const authorSpan = document.createElement('span');
            authorSpan.className = 'author';
            authorSpan.textContent = work.author;
            authorSpan.dataset.author = work.author;
            authorSpan.addEventListener('click', handleAuthorClick);

            infoDiv.appendChild(titleSpan);
            infoDiv.appendChild(authorSpan);
            // --- 정보 영역 끝 ---

            const img = document.createElement('img');
            img.src = `works/${work.id}/${work.firstImage}`;
            img.alt = `${work.title} / ${work.author}`;
            img.loading = 'lazy';
             // 이미지 로드 실패 시 대체 처리 (선택 사항)
            img.onerror = function() {
                console.error("Failed to load image:", img.src);
                // img.alt = `이미지 로드 실패: ${work.title}`;
                // img.style.display = 'none'; // 또는 대체 이미지 표시
            };


            // *** 순서 변경: 정보(infoDiv) -> 이미지(img) ***
            link.appendChild(infoDiv);
            link.appendChild(img);

            workDiv.appendChild(link);
            galleryContainer.appendChild(workDiv);
        } catch (error) {
             console.error("Error rendering work item:", work, error);
        }
      });
    }

    // ========================================
    // === 작가 이름 클릭 핸들러 ===
    // ========================================
    function handleAuthorClick(event) {
      event.preventDefault(); // 링크 이동 방지
      event.stopPropagation(); // 이벤트 버블링 중단

      const authorName = event.target.dataset.author;
      if (authorName) {
        filterGalleryByAuthor(authorName);
      }
    }

    // ========================================
    // === 작가별 필터링 함수 ===
    // ========================================
    function filterGalleryByAuthor(authorName) {
      // console.log('Filtering by:', authorName); // 디버깅
      currentFilter = authorName; // 현재 필터 상태 저장
      // worksData가 로드되었는지 확인
      if (typeof worksData !== 'undefined') {
          const filteredData = worksData.filter(work => work.author === authorName);
          renderGallery(filteredData); // 필터링된 데이터로 갤러리 다시 렌더링
      } else {
          console.error("Cannot filter: worksData is not defined.");
      }
    }

    // ========================================
    // === 전체 목록 보기 함수 ===
    // ========================================
    function showAllWorks() {
       // console.log('Showing all works'); // 디버깅
       currentFilter = null; // 필터 상태 해제
       if (typeof worksData !== 'undefined') {
            renderGallery(worksData); // 전체 데이터로 갤러리 다시 렌더링
       } else {
            console.error("Cannot show all: worksData is not defined.");
       }
    }

     // ========================================
    // === 필터링 정보 표시 업데이트 ===
    // ========================================
    function updateFilterInfo() {
        filterInfoContainer.innerHTML = ''; // 초기화
        if (currentFilter) {
            const infoP = document.createElement('p');
            infoP.className = 'filter-info';
            infoP.innerHTML = `<strong>${currentFilter}</strong> 작가 작품만 보는 중`;

            const showAllButton = document.createElement('button');
            showAllButton.textContent = '전체 보기';
            showAllButton.onclick = showAllWorks; // 버튼 클릭 시 전체 보기 함수 호출

            infoP.appendChild(showAllButton);
            filterInfoContainer.appendChild(infoP);
        }
    }


    // ========================================
    // === 초기 갤러리 렌더링 및 이벤트 리스너 설정 ===
    // ========================================
    // worksData 변수가 works-list.js 로딩 후 사용 가능한지 확인
    // DOMContentLoaded 이벤트 리스너 안에서 실행하는 것이 더 안전할 수 있음
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof worksData !== 'undefined' && worksData.length >= 0) { // worksData가 빈 배열일 수도 있음
             renderGallery(worksData); // 페이지 로드 시 전체 목록 표시
        } else {
            console.error("worksData is not defined or empty! Make sure works-list.js is loaded and generated correctly.");
            if (galleryContainer) { // galleryContainer가 있는지 확인
                galleryContainer.innerHTML = '<p style="text-align: center;">작품 데이터를 불러올 수 없습니다. 빌드 스크립트를 실행하세요.</p>';
            }
        }
        if (mainTitle) { // mainTitle 요소가 있는지 확인 후 이벤트 리스너 추가
            mainTitle.addEventListener('click', showAllWorks); // 제목 클릭 시 전체 보기
        } else {
            console.error("mainTitle element not found!");
        }
    });


  </script>
</body>
</html>
